# =========================
#  Spring Boot Application
# =========================
spring.application.name=connector
server.port=9090

# =========================
#  Datasource (PostgreSQL + HikariCP)
# =========================
spring.datasource.url=jdbc:postgresql://localhost:5433/connector_db_15
spring.datasource.username=postgres
spring.datasource.password=potteri1972

# ???? 24; ???? ????? ??? ???????????? ?????
spring.datasource.hikari.maximum-pool-size=32
spring.datasource.hikari.minimum-idle=4
spring.datasource.hikari.connection-timeout=10000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.data-source-properties.applicationName=ScanConnector

# =========================
#  JPA
# =========================
spring.jpa.hibernate.ddl-auto=update
spring.jpa.open-in-view=false

# =========================
#  Security
# =========================
security.encryption.key=MySecretKey12345

# =========================
#  Connector (task generator)
# =========================
connector.scan.thread-pool-size=16
connector.scan.batch-size=500
connector.scheduler.fixedDelay=10s
connector.consumer.db-chunk-size=1000
connector.scan.per-host-limit=50
connector.scan.reserve-timeout-minutes=10


# =========================
#  Retry
# =========================
connector.retry.max-attempts=4
#connector.retry.strategy=exponential
#connector.retry.initial.ms=200
# connector.retry.strategy=fixed
# connector.retry.fixed.ms=1000
connector.retry.multiplier=2.0
connector.retry.max.ms=2000

# ???? ????? ????????????? ???-???:
# connector.retry.strategy=fixed
# connector.retry.fixed.ms=1000

# =========================
#  Kafka
# =========================
spring.kafka.bootstrap-servers=localhost:9092

# Producer
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.properties.enable.idempotence=true
spring.kafka.producer.linger-ms=10
spring.kafka.producer.batch-size=131072
spring.kafka.producer.buffer-memory=67108864
spring.kafka.producer.compression-type=lz4
spring.kafka.producer.retries=10
spring.kafka.producer.properties.retry.backoff.ms=200
spring.kafka.producer.properties.max.in.flight.requests.per.connection=5
spring.kafka.producer.properties.request.timeout.ms=30000
spring.kafka.producer.properties.delivery.timeout.ms=60000

# Consumer (??????? ??? ??????????? Spring; ???? raw-?????????? ?????? ???? props)
spring.kafka.consumer.enable-auto-commit=false
spring.kafka.consumer.auto-offset-reset=latest
spring.kafka.consumer.fetch-max-bytes=5242880
spring.kafka.consumer.properties.fetch.min.bytes=1048576
spring.kafka.consumer.properties.fetch.max.wait.ms=50
spring.kafka.consumer.properties.max.partition.fetch.bytes=33554432
spring.kafka.consumer.max-poll-records=${connector.scan.batch-size}
spring.kafka.consumer.max-poll-interval-ms=600000
spring.kafka.consumer.group-id=scanner-group
spring.kafka.consumer.properties.partition.assignment.strategy=org.apache.kafka.clients.consumer.CooperativeStickyAssignor

# =========================
#  Topics / toggles
# =========================
connector.kafka.enabled=true
connector.kafka.concurrency=${connector.scan.thread-pool-size}
connector.kafka.scan-tasks-topic=scan-tasks-topic
connector.kafka.users-topic=users-topic

# =========================
#  Load test toggles
# =========================
loadtest.enabled=false
loadtest.mode=kafka
loadtest.servers=100000
loadtest.accounts=1000000
loadtest.batch-size=1000
loadtest.concurrency=4
loadtest.seed-servers=true

# =========================
#  SSH
# =========================
ssh.retries=3
ssh.retry-delay-ms=100

# =========================
#  Logging
# =========================
spring.devtools.livereload.enabled=false
logging.level.com.zaxxer.hikari=INFO
logging.level.org.springframework.kafka=INFO
logging.level.org.apache.kafka=ERROR
logging.level.kafka=ERROR
logging.level.org.apache.kafka.clients.consumer.internals=ERROR
logging.level.org.apache.kafka.clients.producer.internals=ERROR
logging.level.org.apache.kafka.clients.consumer.ConsumerConfig=ERROR
logging.level.com.glt.connector.connector.windows=DEBUG
logging.level.com.glt.connector.service.kafka=DEBUG

logging.file.path=logs
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss,Europe/Moscow} [%thread] %-5level %logger{36} - %msg%n
